# AI协作功能集成说明

## 🎨 功能概述

AI协作助手为canvas画板应用提供智能图像生成和编辑功能：

### ✨ 核心功能
- **🖼️ AI图像生成**：文本描述转图像，支持6种艺术风格和3种质量档次
- **🎨 AI图像编辑**：对画布上的图片进行智能编辑
- **🇨🇳 国产AI服务**：阿里云通义万相，稳定可靠
- **💰 超值免费额度**：500张免费额度，有效期180天

## 🚀 选择阿里云通义万相的理由

### 为什么选择阿里云通义万相？
- **💰 免费额度超值**：500张免费额度（远超其他服务）
- **🇨🇳 国内服务**：访问速度快，网络稳定
- **🎨 质量优秀**：阿里达摩院技术，图像质量出色
- **💳 透明计费**：0.04-0.20元/张，价格清晰

## 📋 环境配置

### 1️⃣ 阿里云通义万相配置

1. **注册阿里云账户**：
   - 访问 https://www.aliyun.com
   - 注册并完成实名认证

2. **开通百炼大模型服务**：
   - 访问 https://bailian.console.aliyun.com
   - 开通服务（免费开通）
   - 自动获得500张免费额度

3. **获取API密钥**：
   - 在百炼控制台，点击"API Key管理"
   - 创建新的API Key
   - 复制生成的DashScope API Key

4. **配置环境变量**：
   ```bash
   # 在项目根目录创建 .env.local 文件
   VITE_ALIYUN_DASHSCOPE_API_KEY=your_dashscope_api_key_here
   ```

### 2️⃣ 模型选择说明

阿里云通义万相提供3种质量档次：

| 模型 | 价格 | 特点 | 适用场景 |
|------|------|------|----------|
| **经济型** | 0.04元/张 | 性价比最高 | 日常创作、快速原型 |
| **标准型** | 0.14元/张 | 生成速度快 | 商业用途、批量生成 |
| **高级型** | 0.20元/张 | 质量最佳 | 精品创作、专业设计 |

### 3️⃣ 免费额度说明

- **额度数量**：各模型均有500张免费额度
- **有效期**：开通后180天内有效
- **共享机制**：主账号与子账号共享额度
- **重置规则**：免费额度用完后需付费使用

## 🎯 使用方法

### AI图像生成
1. 点击画布右上角"AI协作"按钮
2. 在"AI生成"标签页中：
   - 输入英文描述（例如：`a cute cat in the garden, cartoon style`）
   - 选择艺术风格（写实、卡通、动漫等）
   - 点击"生成图片"
3. 生成的图片会自动添加到画布中心

### AI图像编辑
1. 在画布上选择一个图片对象
2. 切换到"AI编辑"标签页，支持以下功能：
   - **🔍 高清放大**：提升图像分辨率和清晰度
   - **🎨 风格转换**：全局风格化处理
   - **✂️ 移除背景**：智能去除图像背景
   - **🧹 去水印**：清除图像中的文字水印
   - **🌈 图像上色**：为黑白图像添加色彩
   - **📐 扩展画布**：智能扩展图像边缘
   - **✏️ 指令编辑**：通过文字指令修改图像内容
3. 可选：在文本框中输入编辑指令（中文或英文）
4. 点击对应功能按钮，编辑后的图片会替换原图片

## 🔧 技术实现

### 文件结构
```
src/
├── components/ai/
│   ├── AICollaborationPanel.jsx     # AI面板组件
│   └── AICollaborationPanel.module.css  # 样式文件
├── services/
│   └── aiService.js                 # AI服务逻辑
└── pages/
    └── CanvasPage.jsx              # 集成AI面板
```

### 服务架构

#### Leonardo AI集成
```javascript
// 图像生成流程
1. 发送生成请求 → Leonardo API
2. 获取任务ID
3. 轮询任务状态 (最多60秒)
4. 获取生成的图片URL
5. 如果失败，降级到Hugging Face
```

#### Hugging Face集成
```javascript
// 备用服务流程
1. 直接调用推理API
2. 处理模型加载状态
3. 返回二进制图片数据
4. 转换为可用URL
```

## 💰 API费用说明

### 阿里云通义万相
- **文生图模型**：
  - 经济型：0.04元/张
  - 标准型：0.14元/张
  - 高级型：0.20元/张
- **图像编辑模型**：0.14元/张
- **免费额度**：各功能500张，有效期180天
- **计费方式**：按成功生成的图片数量收费

## 🔍 API状态检查

在AI面板中点击"测试连接"按钮可以：
- 检查API密钥有效性
- 查看剩余额度
- 测试服务可用性
- 诊断连接问题

## ⚡ 性能优化

### 使用建议
1. **优化描述词**：使用具体、清晰的英文描述
2. **合理间隔**：避免频繁连续调用
3. **监控额度**：定期检查剩余tokens
4. **错误处理**：注意API错误提示

### 常见问题

**Q: 阿里云通义万相支持中文提示词吗？**
A: 是的！阿里云通义万相对中文支持很好，可以直接使用中文描述。

**Q: 图片生成需要多长时间？**
A: 文生图约需1-3分钟，图像编辑约需30秒-2分钟，具体时间取决于服务负载。

**Q: 免费额度用完了怎么办？**
A: 免费额度有180天有效期，用完后需要充值付费使用，价格透明合理。

**Q: 图像编辑支持哪些功能？**
A: 支持高清放大、风格转换、移除背景、去水印、图像上色、扩展画布和指令编辑等7种功能。

## 🔐 安全提醒

- **保护API密钥**：不要将API密钥提交到版本控制
- **环境变量**：使用 `.env.local` 文件存储敏感信息
- **定期更换**：建议定期更换API密钥

## 🎨 扩展功能

当前版本专注于核心功能，未来可扩展：
- 更多图像编辑选项
- 批量图像处理
- 自定义模型选择
- 图像风格学习

---

🎉 **现在就开始使用AI协作功能，让创作更加智能和高效！**